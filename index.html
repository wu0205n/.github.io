<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>GitHub Pages éœæ…‹ç¶²ç«™éƒ¨ç½²èˆ‡å±•ç¤º</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            background-color: #f9f9f9;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        .weather-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        .weather-box {
            padding: 15px;
            background-color: #e0f7fa;
            border-radius: 8px;
        }
        .update-time {
            font-size: 0.9em;
            color: #555;
            margin-top: 5px;
        }
        canvas {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>

    <h1>é«˜é›„ç§‘æŠ€å¤§å­¸ æµ·äº‹è³‡è¨Šç§‘æŠ€ç³»</h1>
    <h2>å°ˆé¡Œåç¨±ï¼šGitHub Pages éœæ…‹ç¶²ç«™éƒ¨ç½²èˆ‡å±•ç¤º</h2>
    <p><strong>æˆå“¡ï¼š</strong>å³æ›œæ©ã€éƒ­æ™‰éŠ˜ã€è•­å‚‘ç¿ã€é«˜ç…œæ¬½</p>

    <div class="weather-grid">

        <!-- æ——æ´¥ -->
        <div class="weather-box">
            <h3>ğŸ“ æ——æ´¥å€ç›®å‰å¤©æ°£ï¼š</h3>
            <p id="weather-now-qijin">è¼‰å…¥ä¸­...</p>
            <p id="now-update-qijin" class="update-time"></p>
            <h3>ğŸ“ˆ å‰å¤©æ°£æº«æŠ˜ç·šåœ–</h3>
            <canvas id="chart-qijin"></canvas>
            <p id="chart-update-qijin" class="update-time"></p>
        </div>

        <!-- ä¸­å£¢ -->
        <div class="weather-box">
            <h3>ğŸ“ ä¸­å£¢å€ç›®å‰å¤©æ°£ï¼š</h3>
            <p id="weather-now-chungli">è¼‰å…¥ä¸­...</p>
            <p id="now-update-chungli" class="update-time"></p>
            <h3>ğŸ“ˆ å‰å¤©æ°£æº«æŠ˜ç·šåœ–</h3>
            <canvas id="chart-chungli"></canvas>
            <p id="chart-update-chungli" class="update-time"></p>
        </div>

        <!-- é­šæ± é„‰ -->
        <div class="weather-box">
            <h3>ğŸ“ é­šæ± é„‰ç›®å‰å¤©æ°£ï¼š</h3>
            <p id="weather-now-yuchi">è¼‰å…¥ä¸­...</p>
            <p id="now-update-yuchi" class="update-time"></p>
            <h3>ğŸ“ˆ å‰å¤©æ°£æº«æŠ˜ç·šåœ–</h3>
            <canvas id="chart-yuchi"></canvas>
            <p id="chart-update-yuchi" class="update-time"></p>
        </div>

    </div>

    <script>
        const weatherText = {
            0: "â˜€ æ™´æœ—",
            1: "ğŸŒ¤ å¤§è‡´æ™´æœ—",
            2: "â›… å¤šé›²",
            3: "â˜ é™°å¤©",
            45: "ğŸŒ« éœ§",
            48: "ğŸŒ« éœ§éœ¾",
            51: "ğŸŒ¦ æ¯›æ¯›é›¨",
            61: "ğŸŒ§ å°é›¨",
            63: "ğŸŒ§ ä¸­é›¨",
            65: "ğŸŒ§ å¤§é›¨",
            71: "â„ å°é›ª",
            80: "ğŸŒ§ çŸ­æš«é™£é›¨",
            95: "â›ˆ é›·é›¨"
        };

        const locations = [
            {
                name: "qijin",
                label: "æ——æ´¥å€",
                lat: 22.6086,
                lon: 120.2719
            },
            {
                name: "chungli",
                label: "ä¸­å£¢å€",
                lat: 24.9547,
                lon: 121.2260
            },
            {
                name: "yuchi",
                label: "é­šæ± é„‰",
                lat: 23.8886,
                lon: 120.9334
            }
        ];

        const today = new Date();
        const targetDate = new Date(today);
        targetDate.setDate(today.getDate() - 2); // å‰å¤©
        const yyyy = targetDate.getFullYear();
        const mm = String(targetDate.getMonth() + 1).padStart(2, '0');
        const dd = String(targetDate.getDate()).padStart(2, '0');
        const dateStr = `${yyyy}-${mm}-${dd}`;

        locations.forEach(loc => {
            // å³æ™‚å¤©æ°£
            const nowUrl = `https://api.open-meteo.com/v1/forecast?latitude=${loc.lat}&longitude=${loc.lon}&current=temperature_2m,apparent_temperature,weather_code&timezone=Asia%2FTaipei`;
            fetch(nowUrl)
                .then(res => res.json())
                .then(data => {
                    const temp = data.current.temperature_2m.toFixed(1);
                    const feel = data.current.apparent_temperature.toFixed(1);
                    const code = data.current.weather_code;
                    const desc = weatherText[code] || "æœªçŸ¥å¤©æ°£";
                    document.getElementById(`weather-now-${loc.name}`).innerText = `${temp}Â°Cï¼ˆé«”æ„Ÿ ${feel}Â°Cï¼‰ï¼Œ${desc}`;
                    document.getElementById(`now-update-${loc.name}`).innerText = `æ›´æ–°æ™‚é–“ï¼š${new Date().toLocaleString("zh-TW")}`;
                })
                .catch(() => {
                    document.getElementById(`weather-now-${loc.name}`).innerText = "âŒ ç„¡æ³•å–å¾—å³æ™‚å¤©æ°£";
                });

            // æŠ˜ç·šåœ–ï¼ˆå‰å¤©ï¼‰
            const chartUrl = `https://archive-api.open-meteo.com/v1/archive?latitude=${loc.lat}&longitude=${loc.lon}&start_date=${dateStr}&end_date=${dateStr}&hourly=temperature_2m&timezone=Asia%2FTaipei`;
            fetch(chartUrl)
                .then(response => response.json())
                .then(data => {
                    const temps = data.hourly.temperature_2m;
                    const hours = Array.from({length: 24}, (_, i) => `${i}:00`);
                    const ctx = document.getElementById(`chart-${loc.name}`).getContext('2d');
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: hours,
                            datasets: [{
                                label: 'æ°£æº«ï¼ˆÂ°Cï¼‰',
                                data: temps,
                                borderColor: 'rgba(75, 192, 192, 1)',
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                fill: true,
                                tension: 0.3,
                                pointRadius: 4,
                                pointHoverRadius: 6
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { display: true },
                                title: {
                                    display: true,
                                    text: `${loc.label} ${dateStr} æ¯å°æ™‚æ°£æº«è®ŠåŒ–åœ–`
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    title: { display: true, text: 'æ°£æº«ï¼ˆÂ°Cï¼‰' }
                                },
                                x: {
                                    title: { display: true, text: 'æ™‚é–“ï¼ˆå°æ™‚ï¼‰' }
                                }
                            }
                        }
                    });

                    document.getElementById(`chart-update-${loc.name}`).innerText = `æ›´æ–°æ™‚é–“ï¼š${new Date().toLocaleString("zh-TW")}`;
                })
                .catch(() => {
                    document.getElementById(`chart-${loc.name}`).remove();
                    document.getElementById(`chart-update-${loc.name}`).innerText = "âŒ ç„¡æ³•å–å¾—æ°£æº«åœ–è³‡æ–™";
                });
        });
    </script>

</body>
</html>
